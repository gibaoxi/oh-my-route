
name: Initialize Project Structure

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # æŽ¨é€åˆ°mainåˆ†æ”¯æ—¶ä¹Ÿè¿è¡Œ
  push:
    branches: [ main ]

jobs:
  initialize:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        # å…è®¸ç©ºæäº¤
        fetch-depth: 0
        
    - name: Create daili directory structure
      run: |
        echo "ðŸš€ å¼€å§‹åˆå§‹åŒ–é¡¹ç›®ç»“æž„..."
        echo "ðŸ“ å½“å‰å·¥ä½œç›®å½•: $(pwd)"
        echo ""
        
        # æ£€æŸ¥dailiç›®å½•æ˜¯å¦å­˜åœ¨
        if [ -d "daili" ]; then
          echo "âœ… dailiç›®å½•å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
          echo "ðŸ“Š dailiç›®å½•å†…å®¹:"
          ls -la daili/
        else
          echo "ðŸ“ åˆ›å»ºdailiç›®å½•..."
          mkdir -p daili
          echo "âœ… dailiç›®å½•åˆ›å»ºæˆåŠŸ"
          
          # åˆ›å»ºå­ç›®å½•
          echo "ðŸ“ åˆ›å»ºå­ç›®å½•..."
          mkdir -p daili/result
          mkdir -p daili/.github/workflows
          
          echo "âœ… ç›®å½•ç»“æž„åˆ›å»ºå®Œæˆ"
        fi
        
        echo ""
        echo "ðŸ“ å®Œæ•´çš„ç›®å½•ç»“æž„:"
        find . -type d | sort
        
    - name: Create basic configuration files
      run: |
        echo ""
        echo "ðŸ“„ å¼€å§‹åˆ›å»ºé…ç½®æ–‡ä»¶..."
        
        # åˆ›å»ºsource.txtï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        if [ ! -f "daili/source.txt" ]; then
          echo "ðŸ“„ åˆ›å»ºsource.txt..."
          cat > daili/source.txt << 'EOF'
[
  {
    "http": [
      "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/http.txt",
      "https://raw.githubusercontent.com/clarketm/proxy-list/master/proxy-list-raw.txt"
    ]
  },
  {
    "https": [
      "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/http.txt"
    ]
  },
  {
    "socks4": [
      "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/socks4.txt"
    ]
  },
  {
    "socks5": [
      "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/socks5.txt",
      "https://raw.githubusercontent.com/hookzof/socks5_list/master/proxy.txt"
    ]
  }
]
EOF
          echo "âœ… source.txtåˆ›å»ºæˆåŠŸ"
        else
          echo "âœ… source.txtå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
        fi
        
        # åˆ›å»ºym.txtï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        if [ ! -f "daili/ym.txt" ]; then
          echo "ðŸ“„ åˆ›å»ºym.txt..."
          cat > daili/ym.txt << 'EOF'
https://www.google.com
https://www.bing.com
https://telegram.org
https://github.com
EOF
          echo "âœ… ym.txtåˆ›å»ºæˆåŠŸ"
        else
          echo "âœ… ym.txtå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
        fi
        
        # åˆ›å»ºrequirements.txtï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        if [ ! -f "daili/requirements.txt" ]; then
          echo "ðŸ“„ åˆ›å»ºrequirements.txt..."
          cat > daili/requirements.txt << 'EOF'
requests==2.31.0
urllib3==2.0.7
EOF
          echo "âœ… requirements.txtåˆ›å»ºæˆåŠŸ"
        else
          echo "âœ… requirements.txtå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
        fi
        
        # åˆ›å»ºç©ºçš„ä»£ç†æ–‡ä»¶ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        for file in http.txt https.txt sock4.txt sock5.txt; do
          if [ ! -f "daili/$file" ]; then
            echo "ðŸ“„ åˆ›å»ºç©ºæ–‡ä»¶: daili/$file"
            echo "# åˆå§‹æ–‡ä»¶ - ç­‰å¾…æµ‹è¯•å¡«å……" > "daili/$file"
          else
            echo "âœ… daili/$fileå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
          fi
        done
        
        echo ""
        echo "ðŸ“Š æ–‡ä»¶åˆ›å»ºå®Œæˆç»Ÿè®¡:"
        echo "dailiç›®å½•å†…å®¹:"
        ls -la daili/
        
    - name: Create main workflow file
      run: |
        echo ""
        echo "âš™ï¸ åˆ›å»ºä¸»å·¥ä½œæµæ–‡ä»¶..."
        
        # åˆ›å»ºä¸»æµ‹è¯•å·¥ä½œæµæ–‡ä»¶
        cat > .github/workflows/proxy-test.yml << 'EOF'
name: Proxy Tester Daily

on:
  schedule:
    # æ¯å¤©UTCæ—¶é—´0ç‚¹è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´8ç‚¹ï¼‰
    - cron: '0 0 * * *'
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-proxies:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      working-directory: ./daili
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Check if proxy_tester.py exists
      working-directory: ./daili
      run: |
        if [ -f "proxy_tester.py" ]; then
          echo "âœ… proxy_tester.pyå­˜åœ¨ï¼Œå‡†å¤‡è¿è¡Œæµ‹è¯•"
          ls -la *.py
        else
          echo "âŒ proxy_tester.pyä¸å­˜åœ¨ï¼Œè¯·å…ˆä¸Šä¼ ä¸»è„šæœ¬"
          exit 1
        fi
        
    - name: Run proxy tester
      working-directory: ./daili
      run: |
        echo "ðŸš€ å¼€å§‹è¿è¡Œä»£ç†æµ‹è¯•..."
        python proxy_tester.py
        
    - name: Commit and push results
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add .
        if git diff-index --quiet HEAD --; then
          echo "â„¹ï¸ æ²¡æœ‰æ£€æµ‹åˆ°æ›´æ”¹"
        else
          git commit -m "ðŸ¤– Auto update proxy test results"
          git push
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
EOF
        echo "âœ… ä¸»å·¥ä½œæµæ–‡ä»¶åˆ›å»ºæˆåŠŸ"
        
    - name: Create README.md
      run: |
        echo "ðŸ“„ åˆ›å»ºREADME.md..."
        cat > README.md << 'EOF'
# ðŸ” ä»£ç†æµ‹è¯•é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æµ‹è¯•HTTPã€HTTPSã€SOCKS4ã€SOCKS5ä»£ç†çš„GitHubé¡¹ç›®ã€‚

## ðŸ“ é¡¹ç›®ç»“æž„

